trigger StockDeductionTrigger on HandsMen_Order__c (after insert, after update) {
    Set<Id> inventoryIds = new Set<Id>();

    for (HandsMen_Order__c order : Trigger.new) {
        if (order.Status__c == 'Confirmed' && order.Inventory_Reference__c != null) {
            inventoryIds.add(order.Inventory_Reference__c);
        }
    }

    if (inventoryIds.isEmpty()) return;

    Map<Id, Inventory__c> inventoryMap = new Map<Id, Inventory__c>(
        [SELECT Id, Stock_Quantity__c FROM Inventory__c WHERE Id IN :inventoryIds]
    );

    List<Inventory__c> inventoriesToUpdate = new List<Inventory__c>();

    for (HandsMen_Order__c order : Trigger.new) {
        if (order.Status__c == 'Confirmed' && order.Inventory_Reference__c != null) {
            Inventory__c inv = inventoryMap.get(order.Inventory_Reference__c);
            if (inv != null && order.Quantity__c != null) {
                inv.Stock_Quantity__c -= order.Quantity__c;
                inventoriesToUpdate.add(inv);
            }
        }
    }

    if (!inventoriesToUpdate.isEmpty()) {
        update inventoriesToUpdate;
    }
}
